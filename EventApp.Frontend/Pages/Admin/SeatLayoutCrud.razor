@* @page "/seat-layouts"
@inject ISeatLayoutClient SeatLayoutService
@inject IDialogService DialogService
@inject ISnackbar Snackbar
@inject LoadingService LoadingService
@inject NavigationManager Nav
@attribute [Authorize(Roles = "Admin")]

<LoadingComponent />

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-6">
    <MudText Typo="Typo.h4" Class="mb-4">Seat Layouts</MudText>

    <MudPaper Class="pa-4 mb-4"
              Style="background: #212121">
        <MudButton Variant="Variant.Outlined"
                   Color="Color.Success"
                   OnClick="@AddLayout">
            <MudIcon Icon="@Icons.Material.Filled.Add"
                     Size="Size.Small"
                     Style="margin: 2px" />
            Seat Layout
        </MudButton>
    </MudPaper>

    <MudTable Items="@layouts"
              Hover="true"
              Dense="true">
        <HeaderContent>
            <MudTh Style="background-color: #000000; color:white;">Name</MudTh>
            <MudTh Style="background-color: #000000; color:white;">Rows</MudTh>
            <MudTh Style="background-color: #000000; color:white;">Columns</MudTh>
            <MudTh Style="background-color: #000000; color:white;">Seats</MudTh>
            <MudTh Style="background-color: #000000; color:white;">Price</MudTh>
            <MudTh Style="background-color: #000000; color:white;">Actions</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Name" Style="background-color: #0B192C; color:white;">@context.Name</MudTd>
            <MudTd DataLabel="Rows" Style="background-color: #0B192C; color:white;">@context.Rows</MudTd>
            <MudTd DataLabel="Columns" Style="background-color: #0B192C; color:white;">@context.Columns</MudTd>
            <MudTd DataLabel="Seats" Style="background-color: #0B192C; color:white;">@context.SeatCount</MudTd>
            <MudTd DataLabel="Price" Style="background-color: #0B192C; color:white;">₱ @context.Price</MudTd>
            <MudTd Style="background-color: #0B192C; color:white;">
                <MudIconButton Icon="@Icons.Material.Filled.Visibility"
                               Color="Color.Primary"
                               OnClick="@(() => ViewSeats(context))"
                               Size="Size.Medium"
                               Style="border: solid; border-width:thin; border-color: blue; padding: 3px" />

                <MudIconButton Icon="@Icons.Material.Outlined.Delete"
                               Color="Color.Error"
                               OnClick="@(() => DeleteLayout(context))"
                               Size="Size.Medium"
                               Style="border: solid; border-width:thin; border-color: red; padding: 3px" />
            </MudTd>
        </RowTemplate>
    </MudTable>
</MudContainer>

@code {
    private List<SeatLayoutDto> layouts = new();

    protected override async Task OnInitializedAsync()
    {
        await LoadLayouts();
    }

    private async Task LoadLayouts()
    {
        layouts = (await SeatLayoutService.GetAllAsync()).ToList();
    }

    private async Task AddLayout()
    {
        var parameters = new DialogParameters { ["Model"] = new CreateSeatLayoutDto() };
        var dialog = DialogService.Show<CreateLayoutFormDialog>("Add Seat Layout", parameters);
        var result = await dialog.Result;

        if (!result.Canceled && result.Data is CreateSeatLayoutDto dto)
        {
            try
            {
                LoadingService.Show("Creating seat layout..."); // Show spinner

                var id = await SeatLayoutService.CreateAsync(dto);

                if (id != null)
                {
                    Snackbar.Add("Seat Layout added successfully.", Severity.Success);
                    await LoadLayouts();
                }
                else
                {
                    Snackbar.Add("Failed to add seat layout.", Severity.Error);
                }
            }
            finally
            {
                LoadingService.Hide(); // Hide spinner
            }
        }
    }

    private async Task DeleteLayout(SeatLayoutDto layout)
    {
        bool? confirmed = await DialogService.ShowMessageBox(
            "Confirm Delete",
            $"Are you sure you want to delete '{layout.Name}'?",
            yesText: "Delete", cancelText: "Cancel");

        if (confirmed == true)
        {
            try
            {
                LoadingService.Show("Deleting seat layout..."); // Show spinner

                var success = await SeatLayoutService.DeleteAsync(layout.Id);

                if (success)
                {
                    Snackbar.Add("Seat Layout deleted.", Severity.Info);
                    await LoadLayouts();
                }
                else
                {
                    Snackbar.Add("This Seat Layout is used in existing event and cannot be deleted.", Severity.Error);
                }
            }
            finally
            {
                LoadingService.Hide(); // Hide spinner
            }
        }
    }

    private void ViewSeats(SeatLayoutDto layout)
    {
        Nav.NavigateTo($"/seat-layouts/{layout.Id}/seats");
    }
}
 *@